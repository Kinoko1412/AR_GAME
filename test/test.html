
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
        "mindar-face-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-three.prod.js"
      }
    }
    </script>
    <script type="module">
      import * as THREE from 'three';
      import { MindARThree } from 'mindar-face-three';

      const list = ["glasses1", "glasses2", "hat1", "hat2", "earring"];
      const visibles = [true, false, false, true, true];
      
      const mindarThree = new MindARThree({
        container: document.querySelector("#container")
      });
      
      const { renderer, scene, camera } = mindarThree;
      const anchors = [];
      
      // 創建多個錨點用於不同配件
      for(let i = 0; i < 5; i++) {
        anchors.push(mindarThree.addAnchor(i));
      }
      
      // 創建配件的3D對象
      const accessories = {};
      
      // 載入配件模型
      const loadAccessory = async (name, anchor, visible) => {
        const geometry = new THREE.SphereGeometry(0.1, 32, 16);
        const material = new THREE.MeshBasicMaterial({ 
          color: 0x00ffff, 
          transparent: true, 
          opacity: visible ? 0.5 : 0
        });
        const mesh = new THREE.Mesh(geometry, material);
        accessories[name] = mesh;
        anchor.group.add(mesh);
      };
      
      // 初始化所有配件
      list.forEach((name, i) => {
        loadAccessory(name, anchors[i], visibles[i]);
      });
      
      // 切換配件可見性
      const toggleAccessory = (name) => {
        if (accessories[name]) {
          const isVisible = accessories[name].material.opacity > 0;
          accessories[name].material.opacity = isVisible ? 0 : 0.5;
        }
      };
      
      // 添加點擊事件
      list.forEach((name) => {
        const element = document.getElementById(name);
        if (element) {
          element.addEventListener('click', () => {
            toggleAccessory(name);
          });
        }
      });
      
      const start = async() => {
        await mindarThree.start();
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera);
        });
      };
      
      const startButton = document.querySelector("#startButton");
      startButton.addEventListener("click", () => {
        start();
      });
      
      const stopButton = document.querySelector("#stopButton");
      stopButton.addEventListener("click", () => {
        mindarThree.stop();
        mindarThree.renderer.setAnimationLoop(null);
      });
    </script>
    <style>
      body {
        margin: 0;
      }
      #container {
        width: 100vw;
        height: 100vh;
        position: relative;
        overflow: hidden;
      }
      #control {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 2;
      }
      .options-panel {
        position: fixed;
        right: 0;
        top: 0;
        bottom: 0;
        width: 80px;
        background-color: rgba(255, 255, 255, 0.8);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
      }
      .options-panel img {
        width: 50px;
        height: 50px;
        margin-bottom: 10px;
        border: 2px solid white;
        cursor: pointer;
      }
      .options-panel img:hover {
        border-color: green;
      }
      .ar-game-btn {
        position: fixed;
        left: 10px;
        bottom: 10px;
        padding: 10px 20px;
        background-color: #f0f0f0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="control">
      <button id="startButton">Start</button>
      <button id="stopButton">Stop</button>
    </div>
    <div id="container"></div>
    <div class="options-panel">
      <img id="hat1" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/hat/thumbnail.png"/>
      <img id="hat2" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/hat2/thumbnail.png"/>
      <img id="glasses1" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/glasses/thumbnail.png"/>
      <img id="glasses2" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/glasses2/thumbnail.png"/>
      <img id="earring" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/earring/thumbnail.png"/>
      <a href="https://kinoko1412.github.io/AR_GAME/" class="ar-game-btn">AR Game</a>
    </div>
  </body>
</html>